
#Область Формирование_отчета

&НаКлиенте
Процедура СформироватьОтчет(Команда)
	
	Если Не ЗначениеЗаполнено(МесяцНачисленияСтрокой) Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ""Не указан месяц!"";	
		Сообщение.Поле = ""МесяцНачисленияСтрокой"";
		Сообщение.Сообщить();
		Возврат;
	КонецЕсли;

	Элементы.Результат.ОтображениеСостояния.Видимость = Истина;
	Элементы.Результат.ОтображениеСостояния.Текст = ""Отчёт формируется..."";
	Элементы.Результат.ОтображениеСостояния.Картинка = БиблиотекаКартинок.ДлительнаяОперация48;
	
	ПодключитьОбработчикОжидания(""ОбновитьОтчет"", 0.1, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьОтчет() Экспорт
   
	СформироватьОтчетНаСервере();
	
	Элементы.Результат.ОтображениеСостояния.Видимость = Ложь; 
	Элементы.Результат.ОтображениеСостояния.ДополнительныйРежимОтображения = ДополнительныйРежимОтображения.НеИспользовать;
			
КонецПроцедуры

&НаСервере
Процедура СформироватьОтчетНаСервере()
	
	ПериодРегистрации = Отчет.ПериодРегистрации;	

	Запрос = Новый Запрос; 
	
	// Установим параметры запроса
	Запрос.УстановитьПараметр(""ПараметрСотрудник"", Сотрудник);
	Запрос.УстановитьПараметр(""ПустаяДата"", Дата(1,1,1));
	Запрос.УстановитьПараметр(""НачалоМесяца"", Началомесяца(ПериодРегистрации));
	Запрос.УстановитьПараметр(""КонецМесяца"", КонецМесяца(ПериодРегистрации));
	Запрос.УстановитьПараметр(""ПервоеЧислоМесяца"", КонецДня(НачалоМесяца(ПериодРегистрации)));
			
	Запрос.УстановитьПараметр(""ВидРасчетаВременноНеТрудоспособен"", ПланыВидовРасчета.Начисления.НайтиПоНаименованию(""Временно нетрудоспособному (часть оклада)""));
	
	мсПоказатели = Новый Массив; // РабочиеЧасы
	мсПоказатели.Добавить(Справочники.ВидыИспользованияРабочегоВремени.РабочееВремя);		
	Запрос.УстановитьПараметр(""РабочиеЧасы"", мсПоказатели);
	мсПоказатели = Новый Массив; // НочныеЧасы	
	мсПоказатели.Добавить(Справочники.ВидыИспользованияРабочегоВремени.РаботаНочныеЧасы); 	
	мсПоказатели.Добавить(Справочники.ВидыИспользованияРабочегоВремени.НайтиПоНаименованию(""Ночные часы""));
	Запрос.УстановитьПараметр(""НочныеЧасы"", мсПоказатели);
	мсПоказатели = Новый Массив; // ПраздничныеЧасы
	мсПоказатели.Добавить(Справочники.ВидыИспользованияРабочегоВремени.Праздники);
	мсПоказатели.Добавить(Справочники.ВидыИспользованияРабочегоВремени.Явка);
	Запрос.УстановитьПараметр(""ПраздничныеЧасы"", мсПоказатели); 		
	
	мсПоказатели = Новый Массив;	
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.Оклад);
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.ОкладПоДолжности);
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.ТарифнаяСтавкаДневная);
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.ТарифнаяСтавкаЧасовая);	
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.ЧасовойТарифПоДолжности);
	мсПоказатели.Добавить(Справочники.ПоказателиРасчетаЗарплаты.ДневнойТарифПоДолжности);
	Запрос.УстановитьПараметр(""ВидыПоказателей"", мсПоказатели);
	Запрос.УстановитьПараметр(""ВтороеЧислоМесяца"", НачалоДня(НачалоМесяца(ПериодРегистрации)) + 1);
	Запрос.УстановитьПараметр(""ВидыПоказателей"", мсПоказатели);
	Запрос.УстановитьПараметр(""ВидыПоказателей"", мсПоказатели);
	
	// Формируем список работавщих в месяце сотрудников
	Запрос.Текст = СформироватьТекстЗапросаПоСпискуСотрудников(); 
	тзСотрудникиРаботающие = Запрос.Выполнить().Выгрузить(); // Сотрудник,ФизическоеЛицоПредставление,ДатаПриема,ДатаУвольнения,ТабНомер
	мсСотрудники = тзСотрудникиРаботающие.ВыгрузитьКолонку(""Сотрудник"");	
	Запрос.УстановитьПараметр(""Сотрудник"", мсСотрудники);
	
	// Данные по подразделениям и должностям
	Запрос.Текст = СформироватьТекстЗапросаПоДолжностямИПодразделениям();
	тзДанныеПоПодразделениямИДолжностям = Запрос.Выполнить().Выгрузить(); // Сотрудник,Период,Подразделение,Должность,ДатаПеремещения
	Запрос.УстановитьПараметр(""втДанныеПоПодразделениямИДолжностям"", тзДанныеПоПодразделениямИДолжностям);

	// Получаем данные по начислениям
	Запрос.Текст = СформироватьТекстЗапросаПоНачислениям();		
	тзДанныеПоНачислениям = Запрос.Выполнить().Выгрузить();  // Сотрудник,ПериодНачисления,ОтработаноДневныхЧасов,НачисленоЗаПраздничные,НачисленоЗаНочные,НачисленоЗаДневные
	
	// Получаем данные по окладам
	Запрос.Текст = СформироватьТекстЗапросаПоОкладам();	
	тзДанныеПоОкладам = Запрос.Выполнить().Выгрузить(); // Сотрудник,Период,Оклад

	// Данные по графикам работы	
	Запрос.Текст = СформироватьТекстЗапросаПоГрафикамРаботы();	
	тзДанныеПоГрафикамРаботы = Запрос.Выполнить().Выгрузить();	// Сотрудник,Период,ГрафикРаботы	
	
	// Данные по разрядам
	Запрос.Текст = СформироватьТекстЗапросаПоРазрядамИКатегории();	
	тзДанныеПоРазрядам = Запрос.Выполнить().Выгрузить();        // Сотрудник,Период,РазрядКатегория
	
	// Объединяем полученные данные в итоговый запрос	
	Запрос.Текст = СформироватьТекстИтоговогоЗапроса();
	Запрос.УстановитьПараметр(""втСотрудникиРаботающие"", тзСотрудникиРаботающие);
	Запрос.УстановитьПараметр(""втДанныеПоНачислениям"", тзДанныеПоНачислениям);
	Запрос.УстановитьПараметр(""втДанныеПоОкладам"", тзДанныеПоОкладам);
	Запрос.УстановитьПараметр(""втДанныеПоГрафикамРаботы"", тзДанныеПоГрафикамРаботы);
	Запрос.УстановитьПараметр(""втДанныеПоРазрядам"", тзДанныеПоРазрядам);
		
	тзИтоговыеДанные = Запрос.Выполнить().Выгрузить();  
	//КОЛОНКИ: Сотрудник,ФизическоеЛицоПредставление,Период,ДатаПриемаПеремещения,ДатаУвольнения,РазрядКатегория,Подразделение,Оклад,
	// 			ОтработаноДневныхЧасов,НачисленоЗаПраздничные,НачисленоЗаНочные,НачисленоЗаДневные,Должность,ГрафикРаботы
	
	Если тзИтоговыеДанные.Количество() = 0 Тогда
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ""Данных нет!"";		
		Сообщение.УстановитьДанные();
		Сообщение.Сообщить();
		Результат.Очистить();
		Возврат;
	КонецЕсли;
	
	// Освобождаем память
	Запрос = Неопределено;
	тзСотрудникиРаботающие = Неопределено;
	тзДанныеПоНачислениям = Неопределено;
	тзДанныеПоОкладам = Неопределено;
	тзДанныеПоГрафикамРаботы = Неопределено;
	тзДанныеПоРазрядам = Неопределено;
	тзДанныеПоПодразделениямИДолжностям = Неопределено;
	
	// Заполняем не заполненные колонки	
	тзИтоговыеДанные.Сортировать(""Сотрудник,Период,ДатаПриемаПеремещения"");
	ПредСтрока = Неопределено;
	
	тзСрезДанныхДляРазрядов = Новый ТаблицаЗначений;
	тзСрезДанныхДляРазрядов.Колонки.Добавить(""Период"", Новый ОписаниеТипов(""Дата""));
	тзСрезДанныхДляРазрядов.Колонки.Добавить(""Сотрудник"", Новый ОписаниеТипов(""СправочникСсылка.Сотрудники""));
	
	тзСрезДанныхДляГрафиков = тзСрезДанныхДляРазрядов.СкопироватьКолонки();
			
	Для каждого текСтрока Из тзИтоговыеДанные Цикл
		Если ПредСтрока = Неопределено Тогда
			ПредСтрока = текСтрока;
			Продолжить;
		КонецЕсли;
		
		Если ПредСтрока.Сотрудник = текСтрока.Сотрудник Тогда
			Если НЕ ЗначениеЗаполнено(текСтрока.Подразделение) И ЗначениеЗаполнено(ПредСтрока.Подразделение) Тогда
				текСтрока.Подразделение = ПредСтрока.Подразделение;			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(текСтрока.Должность) И ЗначениеЗаполнено(ПредСтрока.Должность) Тогда
				текСтрока.Должность = ПредСтрока.Должность;			
			КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(текСтрока.Оклад) И ЗначениеЗаполнено(ПредСтрока.Оклад) Тогда
				текСтрока.Оклад = ПредСтрока.Оклад;			
			КонецЕсли;
			
			//Если НЕ ЗначениеЗаполнено(текСтрока.РазрядКатегория) И ЗначениеЗаполнено(ПредСтрока.РазрядКатегория) Тогда				
			//	новСтр = тзСрезДанныхДляРазрядов.Добавить();
			//	ЗаполнитьЗначенияСвойств(новСтр, текСтрока); 
			//КонецЕсли;
			
			Если НЕ ЗначениеЗаполнено(текСтрока.ГрафикРаботы) И ЗначениеЗаполнено(ПредСтрока.ГрафикРаботы) Тогда				
				новСтр = тзСрезДанныхДляГрафиков.Добавить();
				ЗаполнитьЗначенияСвойств(новСтр, текСтрока); 
			КонецЕсли;
			 
		КонецЕсли;
		
		ПредСтрока = текСтрока;
	КонецЦикла;
	
	//Если тзСрезДанныхДляРазрядов.Количество() > 0 Тогда
	//	Запрос = Новый Запрос;
	//	Запрос.Текст = СформироватьТекстДополнительногоЗапросаПоРазрядам();
	//	Запрос.УстановитьПараметр(""тзСрезДанных"", тзСрезДанныхДляРазрядов);
	//	Запрос.УстановитьПараметр(""КонецМесяца"", КонецМесяца(ПериодРегистрации));
	//	РезультатЗапроса = Запрос.Выполнить();
	//	Выборка = РезультатЗапроса.Выбрать();
	//	
	//	Пока Выборка.Следующий() Цикл			
	//		отбор = Новый Структура(""Период,Сотрудник"", Выборка.Период, Выборка.Сотрудник);
	//		найтиСтроки = тзИтоговыеДанные.НайтиСтроки(отбор);
	//		Если найтиСтроки.Количество() > 0 Тогда
	//			найтиСтроки[0].РазрядКатегория = Выборка.РазрядКатегория;	
	//		КонецЕсли;
	//	КонецЦикла;
	//	
	//	тзСрезДанныхДляРазрядов.Очистить();
	//КонецЕсли;
	
	Если тзСрезДанныхДляГрафиков.Количество() > 0 Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = СформироватьТекстДополнительногоЗапросаПоГрафикам();
		Запрос.УстановитьПараметр(""тзСрезДанных"", тзСрезДанныхДляГрафиков);
		Запрос.УстановитьПараметр(""КонецМесяца"", КонецМесяца(ПериодРегистрации));
		РезультатЗапроса = Запрос.Выполнить();
		Выборка = РезультатЗапроса.Выбрать();
		
		Пока Выборка.Следующий() Цикл			
			отбор = Новый Структура(""Период,Сотрудник"", Выборка.Период, Выборка.Сотрудник);
			найтиСтроки = тзИтоговыеДанные.НайтиСтроки(отбор);
			Если найтиСтроки.Количество() > 0 Тогда
				найтиСтроки[0].ГрафикРаботы = Выборка.ГрафикРаботы;	
			КонецЕсли;
		КонецЦикла;
		
		тзСрезДанныхДляГрафиков.Очистить();
	КонецЕсли;

	
	// Передаем данные в СКД
	СхемаКомпоновкиДанных = РеквизитФормыВЗначение(""Отчет"").ПолучитьМакет(""ОсновнаяСхемаКомпоновкиДанных"");
	Настройки = Отчет.КомпоновщикНастроек.Настройки; 
	ДанныеРасшифровкиСКД = Новый ДанныеРасшифровкиКомпоновкиДанных;
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, Настройки, ДанныеРасшифровкиСКД);
	ВнешнийНаборДанных = Новый Структура(""тзИтоговыеДанные"", тзИтоговыеДанные);
	
	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки, ВнешнийНаборДанных, ДанныеРасшифровкиСКД);
	
	Результат.Очистить();
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(Результат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);
	
	ДанныеРасшифровки = ПоместитьВоВременноеХранилище(ДанныеРасшифровкиСКД, ЭтаФорма.УникальныйИдентификатор);
		
КонецПроцедуры

#КонецОбласти

#Область Формирование_текстов_для_запросов

&НаСервереБезКонтекста
Функция СформироватьТекстИтоговогоЗапроса()

	// колонки таблиц значений:
	
	// тзСотрудникиРаботающие // Сотрудник,ФизическоеЛицоПредставление,ДатаПриема,ДатаУвольнения,ТабНомер
	// тзДанныеПоНачислениям // Сотрудник,ПериодНачисления,ОтработаноДневныхЧасов,НачисленоЗаПраздничные,НачисленоЗаНочные,НачисленоЗаДневные	
	// тзДанныеПоОкладам // Сотрудник,Период,Оклад
	// тзДанныеПоГрафикамРаботы // Сотрудник,Период,ГрафикРаботы
	// тзДанныеПоРазрядам // Сотрудник,Период,РазрядКатегория
	// тзДанныеПоПодразделениямИДолжностям // Сотрудник,Период,Подразделение,Должность,ДатаПеремещения

	Текст = 
	""ВЫБРАТЬ
	|	СписокРаботников.Сотрудник,
	|	СписокРаботников.ТабНомер,
	|	СписокРаботников.ФизическоеЛицоПредставление,
	|	СписокРаботников.ДатаПриема,
	|	СписокРаботников.ДатаУвольнения
	|ПОМЕСТИТЬ втСотрудникиРаботающие
	|ИЗ
	|	&втСотрудникиРаботающие КАК СписокРаботников
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоНачислениям.Сотрудник,
	|	ДанныеПоНачислениям.ПериодНачисления,
	|	ДанныеПоНачислениям.ОтработаноДневныхЧасов,
	|	ДанныеПоНачислениям.НачисленоЗаПраздничные,
	|	ДанныеПоНачислениям.НачисленоЗаНочные,
	|	ДанныеПоНачислениям.НачисленоЗаДневные
	|ПОМЕСТИТЬ втДанныеПоНачислениям
	|ИЗ
	|	&втДанныеПоНачислениям КАК ДанныеПоНачислениям
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоОкладам.Сотрудник,
	|	ДанныеПоОкладам.Период,
	|	ДанныеПоОкладам.Оклад
	|ПОМЕСТИТЬ втДанныеПоОкладам
	|ИЗ
	|	&втДанныеПоОкладам КАК ДанныеПоОкладам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоГрафикамРаботы.Сотрудник,
	|	ДанныеПоГрафикамРаботы.Период,
	|	ДанныеПоГрафикамРаботы.ГрафикРаботы
	|ПОМЕСТИТЬ втДанныеПоГрафикамРаботы
	|ИЗ
	|	&втДанныеПоГрафикамРаботы КАК ДанныеПоГрафикамРаботы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоРазрядам.Сотрудник,
	|	ДанныеПоРазрядам.Период,
	|	ДанныеПоРазрядам.РазрядКатегория
	|ПОМЕСТИТЬ втДанныеПоРазрядам
	|ИЗ
	|	&втДанныеПоРазрядам КАК ДанныеПоРазрядам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ДанныеПоПодразделениямИДолжностям.Сотрудник,
	|	ДанныеПоПодразделениямИДолжностям.Период,
	|	ДанныеПоПодразделениямИДолжностям.Подразделение,
	|	ДанныеПоПодразделениямИДолжностям.Должность,
	|	ДанныеПоПодразделениямИДолжностям.ДатаПеремещения
	|ПОМЕСТИТЬ втДанныеПоПодразделениямИДолжностям
	|ИЗ
	|	&втДанныеПоПодразделениямИДолжностям КАК ДанныеПоПодразделениямИДолжностям
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втДанныеПоПодразделениямИДолжностям.Сотрудник КАК Сотрудник,
	|	втДанныеПоПодразделениямИДолжностям.Период КАК Период,
	|	втДанныеПоПодразделениямИДолжностям.Подразделение КАК Подразделение,
	|	втДанныеПоПодразделениямИДолжностям.Должность КАК Должность,
	|	NULL КАК Оклад,
	|	втДанныеПоПодразделениямИДолжностям.ДатаПеремещения
	|ПОМЕСТИТЬ втОбъединениеДанных
	|ИЗ
	|	втДанныеПоПодразделениямИДолжностям КАК втДанныеПоПодразделениямИДолжностям
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втДанныеПоОкладам.Сотрудник,
	|	втДанныеПоОкладам.Период,
	|	NULL,
	|	NULL,
	|	втДанныеПоОкладам.Оклад,
	|	&ПустаяДата
	|ИЗ
	|	втДанныеПоОкладам КАК втДанныеПоОкладам
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОбъединениеДанных.Период,
	|	втОбъединениеДанных.Сотрудник,
	|	МАКСИМУМ(втОбъединениеДанных.Оклад) КАК Оклад,
	|	МАКСИМУМ(втОбъединениеДанных.Подразделение) КАК Подразделение,
	|	МАКСИМУМ(втОбъединениеДанных.Должность) КАК Должность,
	|	МАКСИМУМ(втОбъединениеДанных.ДатаПеремещения) КАК ДатаПеремещения
	|ПОМЕСТИТЬ втОсновныеКадровыеДанные
	|ИЗ
	|	втОбъединениеДанных КАК втОбъединениеДанных
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеДанных.Период,
	|	втОбъединениеДанных.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втДанныеПоНачислениям.Сотрудник,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА втДанныеПоНачислениям.ПериодНачисления < втОсновныеКадровыеДанные.Период
	|				ТОГДА втДанныеПоНачислениям.ПериодНачисления
	|			ИНАЧЕ втОсновныеКадровыеДанные.Период
	|		КОНЕЦ) КАК ПериодМинимум
	|ПОМЕСТИТЬ втПервыеНачисления
	|ИЗ
	|	втДанныеПоНачислениям КАК втДанныеПоНачислениям
	|		ЛЕВОЕ СОЕДИНЕНИЕ втОсновныеКадровыеДанные КАК втОсновныеКадровыеДанные
	|		ПО втДанныеПоНачислениям.Сотрудник = втОсновныеКадровыеДанные.Сотрудник
	|
	|СГРУППИРОВАТЬ ПО
	|	втДанныеПоНачислениям.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втДанныеПоРазрядам.Сотрудник,
	|	МИНИМУМ(ВЫБОР
	|			КОГДА втДанныеПоРазрядам.Период < втОсновныеКадровыеДанные.Период
	|				ТОГДА втДанныеПоРазрядам.Период
	|			ИНАЧЕ втОсновныеКадровыеДанные.Период
	|		КОНЕЦ) КАК ПериодМинимум,
	|	МАКСИМУМ(втДанныеПоРазрядам.Период) КАК Период,
	|	втОсновныеКадровыеДанные.Период КАК ПериодДанных
	|ПОМЕСТИТЬ втМаксПериодРазрядов
	|ИЗ
	|	втДанныеПоРазрядам КАК втДанныеПоРазрядам
	|		ЛЕВОЕ СОЕДИНЕНИЕ втОсновныеКадровыеДанные КАК втОсновныеКадровыеДанные
	|		ПО втДанныеПоРазрядам.Сотрудник = втОсновныеКадровыеДанные.Сотрудник
	|			И втДанныеПоРазрядам.Период >= втОсновныеКадровыеДанные.Период
	|
	|СГРУППИРОВАТЬ ПО
	|	втДанныеПоРазрядам.Сотрудник,
	|	втОсновныеКадровыеДанные.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОсновныеКадровыеДанные.Сотрудник,
	|	втОсновныеКадровыеДанные.Период,
	|	втОсновныеКадровыеДанные.ДатаПеремещения,
	|	втОсновныеКадровыеДанные.Оклад,
	|	NULL КАК ГрафикРаботы,
	|	NULL КАК РазрядКатегория,
	|	втОсновныеКадровыеДанные.Подразделение,
	|	втОсновныеКадровыеДанные.Должность,
	|	NULL КАК ОтработаноДневныхЧасов,
	|	NULL КАК НачисленоЗаПраздничные,
	|	NULL КАК НачисленоЗаНочные,
	|	NULL КАК НачисленоЗаДневные
	|ПОМЕСТИТЬ втОбъединениеКадровИНачислении
	|ИЗ
	|	втОсновныеКадровыеДанные КАК втОсновныеКадровыеДанные
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втДанныеПоНачислениям.Сотрудник,
	|	ВЫБОР
	|		КОГДА втОсновныеКадровыеДанные.Период ЕСТЬ NULL
	|			ТОГДА втПервыеНачисления.ПериодМинимум
	|		ИНАЧЕ втДанныеПоНачислениям.ПериодНачисления
	|	КОНЕЦ,
	|	&ПустаяДата,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	втДанныеПоНачислениям.ОтработаноДневныхЧасов,
	|	втДанныеПоНачислениям.НачисленоЗаПраздничные,
	|	втДанныеПоНачислениям.НачисленоЗаНочные,
	|	втДанныеПоНачислениям.НачисленоЗаДневные
	|ИЗ
	|	втДанныеПоНачислениям КАК втДанныеПоНачислениям
	|		ЛЕВОЕ СОЕДИНЕНИЕ втОсновныеКадровыеДанные КАК втОсновныеКадровыеДанные
	|		ПО втДанныеПоНачислениям.Сотрудник = втОсновныеКадровыеДанные.Сотрудник
	|			И втДанныеПоНачислениям.ПериодНачисления = втОсновныеКадровыеДанные.Период
	|		ЛЕВОЕ СОЕДИНЕНИЕ втПервыеНачисления КАК втПервыеНачисления
	|		ПО втДанныеПоНачислениям.Сотрудник = втПервыеНачисления.Сотрудник
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втДанныеПоГрафикамРаботы.Сотрудник,
	|	втДанныеПоГрафикамРаботы.Период,
	|	&ПустаяДата,
	|	NULL,
	|	втДанныеПоГрафикамРаботы.ГрафикРаботы,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL
	|ИЗ
	|	втДанныеПоГрафикамРаботы КАК втДанныеПоГрафикамРаботы
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втДанныеПоРазрядам.Сотрудник,
	|	втМаксПериодРазрядов.ПериодДанных,
	|	&ПустаяДата,
	|	NULL,
	|	NULL,
	|	втДанныеПоРазрядам.РазрядКатегория,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL,
	|	NULL
	|ИЗ
	|	втДанныеПоРазрядам КАК втДанныеПоРазрядам
	|		ЛЕВОЕ СОЕДИНЕНИЕ втОсновныеКадровыеДанные КАК втОсновныеКадровыеДанные
	|		ПО втДанныеПоРазрядам.Сотрудник = втОсновныеКадровыеДанные.Сотрудник
	|			И втДанныеПоРазрядам.Период = втОсновныеКадровыеДанные.Период
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаксПериодРазрядов КАК втМаксПериодРазрядов
	|		ПО втДанныеПоРазрядам.Сотрудник = втМаксПериодРазрядов.Сотрудник
	|			И втДанныеПоРазрядам.Период = втМаксПериодРазрядов.ПериодДанных
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОбъединениеКадровИНачислении.Сотрудник,
	|	втОбъединениеКадровИНачислении.Период,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.Оклад) КАК Оклад,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.ГрафикРаботы) КАК ГрафикРаботы,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.РазрядКатегория) КАК РазрядКатегория,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.Подразделение) КАК Подразделение,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.Должность) КАК Должность,
	|	СУММА(втОбъединениеКадровИНачислении.ОтработаноДневныхЧасов) КАК ОтработаноДневныхЧасов,
	|	СУММА(втОбъединениеКадровИНачислении.НачисленоЗаПраздничные) КАК НачисленоЗаПраздничные,
	|	СУММА(втОбъединениеКадровИНачислении.НачисленоЗаНочные) КАК НачисленоЗаНочные,
	|	СУММА(втОбъединениеКадровИНачислении.НачисленоЗаДневные) КАК НачисленоЗаДневные,
	|	МАКСИМУМ(втОбъединениеКадровИНачислении.ДатаПеремещения) КАК ДатаПеремещения
	|ПОМЕСТИТЬ втГруппировкаРезультата
	|ИЗ
	|	втОбъединениеКадровИНачислении КАК втОбъединениеКадровИНачислении
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеКадровИНачислении.Сотрудник,
	|	втОбъединениеКадровИНачислении.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втГруппировкаРезультата.Сотрудник,
	|	втСотрудникиРаботающие.ТабНомер,
	|	втСотрудникиРаботающие.ФизическоеЛицоПредставление,
	|	втГруппировкаРезультата.Период,
	|	ВЫБОР
	|		КОГДА втСотрудникиРаботающие.ДатаПриема > втГруппировкаРезультата.ДатаПеремещения
	|			ТОГДА втСотрудникиРаботающие.ДатаПриема
	|		ИНАЧЕ втГруппировкаРезультата.ДатаПеремещения
	|	КОНЕЦ КАК ДатаПриемаПеремещения,
	|	втСотрудникиРаботающие.ДатаУвольнения,
	|	втГруппировкаРезультата.Оклад,
	|	втГруппировкаРезультата.ГрафикРаботы,
	|	втГруппировкаРезультата.РазрядКатегория,
	|	втГруппировкаРезультата.Подразделение,
	|	втГруппировкаРезультата.Должность,
	|	втГруппировкаРезультата.ОтработаноДневныхЧасов,
	|	втГруппировкаРезультата.НачисленоЗаПраздничные,
	|	втГруппировкаРезультата.НачисленоЗаНочные,
	|	втГруппировкаРезультата.НачисленоЗаДневные
	|ИЗ
	|	втГруппировкаРезультата КАК втГруппировкаРезультата
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСотрудникиРаботающие КАК втСотрудникиРаботающие
	|		ПО втГруппировкаРезультата.Сотрудник = втСотрудникиРаботающие.Сотрудник"";
	Возврат Текст;

КонецФункции // СформироватьТекстИтоговогоЗапроса()

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоСпискуСотрудников()
	
	ТекстЗапроса = 
	""ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТекущиеКадровыеДанныеСотрудников.Сотрудник КАК Сотрудник,
	|	ТекущиеКадровыеДанныеСотрудников.Сотрудник.ФизическоеЛицо.Представление КАК ФизическоеЛицоПредставление,
	|	ТекущиеКадровыеДанныеСотрудников.ДатаПриема,
	|	ВЫБОР
	|		КОГДА ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения > &КонецМесяца
	|			ТОГДА &ПустаяДата
	|		ИНАЧЕ ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения
	|	КОНЕЦ КАК ДатаУвольнения,
	|	ТекущиеКадровыеДанныеСотрудников.Сотрудник.Код КАК ТабНомер
	|ИЗ
	|	РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
	|ГДЕ
	|	ТекущиеКадровыеДанныеСотрудников.ДатаПриема <= &КонецМесяца
	|	И ТекущиеКадровыеДанныеСотрудников.ДатаПриема <> &ПустаяДата
	|	И (ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения = &ПустаяДата
	|			ИЛИ ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения >= &НачалоМесяца)
	|	И ВЫБОР
	|			КОГДА &ПараметрСотрудник = ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)
	|				ТОГДА ИСТИНА
	|			ИНАЧЕ ТекущиеКадровыеДанныеСотрудников.Сотрудник = &ПараметрСотрудник
	|		КОНЕЦ"";
	Возврат ТекстЗапроса;
	
КонецФункции

&НаСервереБезКонтекста
Функция СформироватьТекстДополнительногоЗапросаПоРазрядам()

	ТекстЗапроса = 
	""ВЫБРАТЬ
	|	Разряды.Период,
	|	Разряды.Сотрудник
	|ПОМЕСТИТЬ втТребуемыеДанные
	|ИЗ
	|	&тзСрезДанных КАК Разряды
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втТребуемыеДанные.Период,
	|	втТребуемыеДанные.Сотрудник,
	|	РазрядыКатегорииСотрудников.РазрядКатегория,
	|	РазрядыКатегорииСотрудников.Период КАК ПериодСрез
	|ПОМЕСТИТЬ втСрезДанных
	|ИЗ
	|	РегистрСведений.РазрядыКатегорииСотрудников КАК РазрядыКатегорииСотрудников
	|		ЛЕВОЕ СОЕДИНЕНИЕ втТребуемыеДанные КАК втТребуемыеДанные
	|		ПО (втТребуемыеДанные.Сотрудник = РазрядыКатегорииСотрудников.Сотрудник)
	|			И (втТребуемыеДанные.Период >= РазрядыКатегорииСотрудников.Период)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезДанных.Сотрудник,
	|	втСрезДанных.Период,
	|	МАКСИМУМ(втСрезДанных.ПериодСрез) КАК ПериодСрез,
	|	втСрезДанных.РазрядКатегория
	|ПОМЕСТИТЬ втМаксимальныеПериоды
	|ИЗ
	|	втСрезДанных КАК втСрезДанных
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезДанных.Сотрудник,
	|	втСрезДанных.Период,
	|	втСрезДанных.РазрядКатегория
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втМаксимальныеПериоды.Сотрудник,
	|	втМаксимальныеПериоды.Период,
	|	втМаксимальныеПериоды.РазрядКатегория
	|ИЗ
	|	втМаксимальныеПериоды КАК втМаксимальныеПериоды"";
	Возврат ТекстЗапроса;

КонецФункции // СформироватьТекстДополнительногоЗапросаПоГрафикам()

&НаСервереБезКонтекста
Функция СформироватьТекстДополнительногоЗапросаПоГрафикам()

	ТекстЗапроса = 
	""ВЫБРАТЬ
	|	Графики.Период,
	|	Графики.Сотрудник
	|ПОМЕСТИТЬ втТребуемыеДанные
	|ИЗ
	|	&тзСрезДанных КАК Графики
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втТребуемыеДанные.Период,
	|	втТребуемыеДанные.Сотрудник,
	|	ГрафикРаботыСотрудников.Период КАК ПериодСрез,
	|	ГрафикРаботыСотрудников.ГрафикРаботы
	|ПОМЕСТИТЬ втСрезДанных
	|ИЗ
	|	РегистрСведений.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников
	|		ЛЕВОЕ СОЕДИНЕНИЕ втТребуемыеДанные КАК втТребуемыеДанные
	|		ПО ГрафикРаботыСотрудников.Сотрудник = втТребуемыеДанные.Сотрудник
	|			И ГрафикРаботыСотрудников.Период <= втТребуемыеДанные.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезДанных.Сотрудник,
	|	втСрезДанных.Период,
	|	МАКСИМУМ(втСрезДанных.ПериодСрез) КАК ПериодСрез,
	|	втСрезДанных.ГрафикРаботы
	|ПОМЕСТИТЬ втМаксимальныеПериоды
	|ИЗ
	|	втСрезДанных КАК втСрезДанных
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезДанных.Сотрудник,
	|	втСрезДанных.Период,
	|	втСрезДанных.ГрафикРаботы
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втМаксимальныеПериоды.Сотрудник,
	|	втМаксимальныеПериоды.Период,
	|	втМаксимальныеПериоды.ГрафикРаботы
	|ИЗ
	|	втМаксимальныеПериоды КАК втМаксимальныеПериоды
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСрезДанных КАК втСрезДанных
	|		ПО втМаксимальныеПериоды.Сотрудник = втСрезДанных.Сотрудник
	|			И втМаксимальныеПериоды.ПериодСрез = втСрезДанных.ПериодСрез"";
	Возврат ТекстЗапроса;

КонецФункции // СформироватьТекстДополнительногоЗапросаПоГрафикам()

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоНачислениям()
	
	ТекстЗапроса = 
	""ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Начисления.Сотрудник,
	|	НАЧАЛОПЕРИОДА(Начисления.ПериодДействияНачало, ДЕНЬ) КАК Период,
	|	Начисления.Результат КАК Начислено,
	|	Начисления.ОтработаноЧасов КАК ОтработаноЧасов,
	|	Начисления.ВидРасчета.ОбозначениеВТабелеУчетаРабочегоВремени КАК ВидУчетаВремени
	|ПОМЕСТИТЬ втФактНачисления
	|ИЗ
	|	РегистрРасчета.Начисления КАК Начисления
	|ГДЕ
	|	Начисления.Активность
	|	И Начисления.ВремяВЧасах
	|	И Начисления.ПериодДействия = &НачалоМесяца
	|	И Начисления.Сотрудник В(&Сотрудник)
	|	И Начисления.ВидРасчета <> &ВидРасчетаВременноНеТрудоспособен
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втФактНачисления.Период,
	|	втФактНачисления.Сотрудник,
	|	втФактНачисления.Начислено КАК НачисленоЗаДневные,
	|	втФактНачисления.ОтработаноЧасов,
	|	NULL КАК НачисленоЗаНочные,
	|	NULL КАК НачисленоЗаПраздничные
	|ПОМЕСТИТЬ втНачисленияПоВремениУчета
	|ИЗ
	|	втФактНачисления КАК втФактНачисления
	|ГДЕ
	|	втФактНачисления.ВидУчетаВремени В(&РабочиеЧасы)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втФактНачисления.Период,
	|	втФактНачисления.Сотрудник,
	|	NULL,
	|	0,
	|	втФактНачисления.Начислено,
	|	NULL
	|ИЗ
	|	втФактНачисления КАК втФактНачисления
	|ГДЕ
	|	втФактНачисления.ВидУчетаВремени В(&НочныеЧасы)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втФактНачисления.Период,
	|	втФактНачисления.Сотрудник,
	|	NULL,
	|	0,
	|	NULL,
	|	втФактНачисления.Начислено
	|ИЗ
	|	втФактНачисления КАК втФактНачисления
	|ГДЕ
	|	втФактНачисления.ВидУчетаВремени В(&ПраздничныеЧасы)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втНачисленияПоВремениУчета.Период КАК ПериодНачисления,
	|	втНачисленияПоВремениУчета.Сотрудник,
	|	СУММА(втНачисленияПоВремениУчета.НачисленоЗаДневные) КАК НачисленоЗаДневные,
	|	СУММА(втНачисленияПоВремениУчета.ОтработаноЧасов) КАК ОтработаноДневныхЧасов,
	|	СУММА(втНачисленияПоВремениУчета.НачисленоЗаНочные) КАК НачисленоЗаНочные,
	|	СУММА(втНачисленияПоВремениУчета.НачисленоЗаПраздничные) КАК НачисленоЗаПраздничные
	|ИЗ
	|	втНачисленияПоВремениУчета КАК втНачисленияПоВремениУчета
	|
	|СГРУППИРОВАТЬ ПО
	|	втНачисленияПоВремениУчета.Период,
	|	втНачисленияПоВремениУчета.Сотрудник"";
	Возврат ТекстЗапроса;
	
КонецФункции

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоОкладам()
	
	ТекстЗапроса = 
	""ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(&ПервоеЧислоМесяца, ДЕНЬ) КАК Период,
	|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Сотрудник,
	|	ВЫБОР
	|		КОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Значение
	|		ИНАЧЕ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ЗначениеПоОкончании
	|	КОНЕЦ КАК Оклад,
	|	ВЫБОР
	|		КОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА &ВтороеЧислоМесяца
	|		ИНАЧЕ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.ДействуетДо
	|	КОНЕЦ КАК ДействуетДо,
	|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних.Период КАК ПериодОклада
	|ПОМЕСТИТЬ втСрезПериодическихПоказателей
	|ИЗ
	|	РегистрСведений.ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.СрезПоследних(
	|			&ПервоеЧислоМесяца,
	|			Сотрудник В (&Сотрудник)
	|				И Показатель В (&ВидыПоказателей)
	|				И НЕ Регистратор ССЫЛКА Документ.Совмещение) КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудниковСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезПериодическихПоказателей.Сотрудник,
	|	МАКСИМУМ(втСрезПериодическихПоказателей.ПериодОклада) КАК ПериодОклада
	|ПОМЕСТИТЬ втМаксимумПериодическихПоказателей
	|ИЗ
	|	втСрезПериодическихПоказателей КАК втСрезПериодическихПоказателей
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезПериодическихПоказателей.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезПериодическихПоказателей.Период,
	|	втСрезПериодическихПоказателей.Сотрудник,
	|	втСрезПериодическихПоказателей.Оклад,
	|	втСрезПериодическихПоказателей.ДействуетДо,
	|	втСрезПериодическихПоказателей.ПериодОклада
	|ПОМЕСТИТЬ втПоследниеПериодическиеПоказатели
	|ИЗ
	|	втМаксимумПериодическихПоказателей КАК втМаксимумПериодическихПоказателей
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСрезПериодическихПоказателей КАК втСрезПериодическихПоказателей
	|		ПО втМаксимумПериодическихПоказателей.Сотрудник = втСрезПериодическихПоказателей.Сотрудник
	|			И втМаксимумПериодическихПоказателей.ПериодОклада = втСрезПериодическихПоказателей.ПериодОклада
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	&ПервоеЧислоМесяца КАК Период,
	|	ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.Сотрудник,
	|	ВЫБОР
	|		КОГДА ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.Значение
	|		ИНАЧЕ ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ЗначениеПоОкончании
	|	КОНЕЦ КАК Оклад,
	|	ВЫБОР
	|		КОГДА ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА &ВтороеЧислоМесяца
	|		ИНАЧЕ ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.ДействуетДо
	|	КОНЕЦ КАК ДействуетДо,
	|	ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних.Период КАК ПериодОклада
	|ПОМЕСТИТЬ втСрезСовокупныхПоказателей
	|ИЗ
	|	РегистрСведений.ЗначенияСовокупныхТарифныхСтавокСотрудников.СрезПоследних(
	|			&ПервоеЧислоМесяца,
	|			Сотрудник В (&Сотрудник)
	|				И НЕ Регистратор ССЫЛКА Документ.Совмещение) КАК ЗначенияСовокупныхТарифныхСтавокСотрудниковСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезСовокупныхПоказателей.Сотрудник,
	|	МАКСИМУМ(втСрезСовокупныхПоказателей.ПериодОклада) КАК ПериодОклада
	|ПОМЕСТИТЬ втМаксимумСовокупныхПоказателей
	|ИЗ
	|	втСрезСовокупныхПоказателей КАК втСрезСовокупныхПоказателей
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезСовокупныхПоказателей.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезСовокупныхПоказателей.Период,
	|	втСрезСовокупныхПоказателей.Сотрудник,
	|	втСрезСовокупныхПоказателей.Оклад,
	|	втСрезСовокупныхПоказателей.ДействуетДо,
	|	втСрезСовокупныхПоказателей.ПериодОклада
	|ПОМЕСТИТЬ втПоследниеСовокупныеПоказатели
	|ИЗ
	|	втМаксимумСовокупныхПоказателей КАК втМаксимумСовокупныхПоказателей
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втСрезСовокупныхПоказателей КАК втСрезСовокупныхПоказателей
	|		ПО втМаксимумСовокупныхПоказателей.Сотрудник = втСрезСовокупныхПоказателей.Сотрудник
	|			И втМаксимумСовокупныхПоказателей.ПериодОклада = втСрезСовокупныхПоказателей.ПериодОклада
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(втПоследниеПериодическиеПоказатели.Период, втПоследниеСовокупныеПоказатели.Период) КАК Период,
	|	ЕСТЬNULL(втПоследниеПериодическиеПоказатели.Сотрудник, втПоследниеСовокупныеПоказатели.Сотрудник) КАК Сотрудник,
	|	ВЫБОР
	|		КОГДА втПоследниеПериодическиеПоказатели.ДействуетДо > втПоследниеСовокупныеПоказатели.ДействуетДо
	|			ТОГДА втПоследниеПериодическиеПоказатели.Оклад
	|		КОГДА втПоследниеПериодическиеПоказатели.ДействуетДо = втПоследниеСовокупныеПоказатели.ДействуетДо
	|			ТОГДА ВЫБОР
	|					КОГДА втПоследниеПериодическиеПоказатели.ПериодОклада > втПоследниеСовокупныеПоказатели.ПериодОклада
	|						ТОГДА втПоследниеПериодическиеПоказатели.Оклад
	|					ИНАЧЕ втПоследниеСовокупныеПоказатели.Оклад
	|				КОНЕЦ
	|		ИНАЧЕ втПоследниеСовокупныеПоказатели.Оклад
	|	КОНЕЦ КАК Оклад
	|ПОМЕСТИТЬ втСрезОкладов
	|ИЗ
	|	втПоследниеПериодическиеПоказатели КАК втПоследниеПериодическиеПоказатели
	|		ПОЛНОЕ СОЕДИНЕНИЕ втПоследниеСовокупныеПоказатели КАК втПоследниеСовокупныеПоказатели
	|		ПО втПоследниеПериодическиеПоказатели.Сотрудник = втПоследниеСовокупныеПоказатели.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Период, ДЕНЬ) КАК Период,
	|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Сотрудник,
	|	ВЫБОР
	|		КОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Значение
	|		ИНАЧЕ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ЗначениеПоОкончании
	|	КОНЕЦ КАК Оклад,
	|	ВЫБОР
	|		КОГДА ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА &КонецМесяца
	|		ИНАЧЕ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.ДействуетДо
	|	КОНЕЦ КАК ДействуетДо,
	|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Период КАК ПериодОклада
	|ПОМЕСТИТЬ втИзмененияПериодическихПоказателей
	|ИЗ
	|	РегистрСведений.ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников КАК ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников
	|ГДЕ
	|	ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Сотрудник В(&Сотрудник)
	|	И ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Показатель В(&ВидыПоказателей)
	|	И ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Период МЕЖДУ &ВтороеЧислоМесяца И &КонецМесяца
	|	И НЕ ЗначенияПериодическихПоказателейРасчетаЗарплатыСотрудников.Регистратор ССЫЛКА Документ.Совмещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(ЗначенияСовокупныхТарифныхСтавокСотрудников.Период, ДЕНЬ) КАК Период,
	|	ЗначенияСовокупныхТарифныхСтавокСотрудников.Сотрудник,
	|	ВЫБОР
	|		КОГДА ЗначенияСовокупныхТарифныхСтавокСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияСовокупныхТарифныхСтавокСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА ЗначенияСовокупныхТарифныхСтавокСотрудников.Значение
	|		ИНАЧЕ ЗначенияСовокупныхТарифныхСтавокСотрудников.ЗначениеПоОкончании
	|	КОНЕЦ КАК Оклад,
	|	ВЫБОР
	|		КОГДА ЗначенияСовокупныхТарифныхСтавокСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ ЗначенияСовокупныхТарифныхСтавокСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА &КонецМесяца
	|		ИНАЧЕ ЗначенияСовокупныхТарифныхСтавокСотрудников.ДействуетДо
	|	КОНЕЦ КАК ДействуетДо,
	|	ЗначенияСовокупныхТарифныхСтавокСотрудников.Период КАК ПериодОклада
	|ПОМЕСТИТЬ втИзмененияСовокупныхПоказателей
	|ИЗ
	|	РегистрСведений.ЗначенияСовокупныхТарифныхСтавокСотрудников КАК ЗначенияСовокупныхТарифныхСтавокСотрудников
	|ГДЕ
	|	ЗначенияСовокупныхТарифныхСтавокСотрудников.Сотрудник В(&Сотрудник)
	|	И ЗначенияСовокупныхТарифныхСтавокСотрудников.Период МЕЖДУ &ВтороеЧислоМесяца И &КонецМесяца
	|	И НЕ ЗначенияСовокупныхТарифныхСтавокСотрудников.Регистратор ССЫЛКА Документ.Совмещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЕСТЬNULL(втИзмененияПериодическихПоказателей.Период, втИзмененияСовокупныхПоказателей.Период) КАК Период,
	|	ЕСТЬNULL(втИзмененияПериодическихПоказателей.Сотрудник, втИзмененияСовокупныхПоказателей.Сотрудник) КАК Сотрудник,
	|	ВЫБОР
	|		КОГДА втИзмененияПериодическихПоказателей.ДействуетДо > втИзмененияСовокупныхПоказателей.ДействуетДо
	|			ТОГДА втИзмененияПериодическихПоказателей.Оклад
	|		КОГДА втИзмененияПериодическихПоказателей.ДействуетДо = втИзмененияСовокупныхПоказателей.ДействуетДо
	|			ТОГДА ВЫБОР
	|					КОГДА втИзмененияПериодическихПоказателей.ПериодОклада > втИзмененияСовокупныхПоказателей.ПериодОклада
	|						ТОГДА втИзмененияПериодическихПоказателей.Оклад
	|					ИНАЧЕ втИзмененияСовокупныхПоказателей.Оклад
	|				КОНЕЦ
	|		ИНАЧЕ втИзмененияСовокупныхПоказателей.Оклад
	|	КОНЕЦ КАК Оклад
	|ПОМЕСТИТЬ втИзмененияОкладов
	|ИЗ
	|	втИзмененияПериодическихПоказателей КАК втИзмененияПериодическихПоказателей
	|		ПОЛНОЕ СОЕДИНЕНИЕ втИзмененияСовокупныхПоказателей КАК втИзмененияСовокупныхПоказателей
	|		ПО втИзмененияПериодическихПоказателей.Сотрудник = втИзмененияСовокупныхПоказателей.Сотрудник
	|			И втИзмененияПериодическихПоказателей.Период = втИзмененияСовокупныхПоказателей.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезОкладов.Период КАК ПериодОклад,
	|	втСрезОкладов.Сотрудник,
	|	втСрезОкладов.Оклад
	|ПОМЕСТИТЬ втОбъединениеДанныхПоОкладам
	|ИЗ
	|	втСрезОкладов КАК втСрезОкладов
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втИзмененияОкладов.Период,
	|	втИзмененияОкладов.Сотрудник,
	|	втИзмененияОкладов.Оклад
	|ИЗ
	|	втИзмененияОкладов КАК втИзмененияОкладов
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	МИНИМУМ(втОбъединениеДанныхПоОкладам.ПериодОклад) КАК Период,
	|	втОбъединениеДанныхПоОкладам.Сотрудник,
	|	втОбъединениеДанныхПоОкладам.Оклад КАК Оклад
	|ИЗ
	|	втОбъединениеДанныхПоОкладам КАК втОбъединениеДанныхПоОкладам
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеДанныхПоОкладам.Сотрудник,
	|	втОбъединениеДанныхПоОкладам.Оклад"";
	Возврат ТекстЗапроса;
	
КонецФункции

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоГрафикамРаботы()
	
	// колонки таблиц значений:
	
	// тзДанныеПоПодразделениямИДолжностям // Сотрудник,Период,Подразделение,Должность
	
	ТекстЗапроса = 
	""ВЫБРАТЬ
	|	ПодразделенияИДолжности.Сотрудник,
	|	ПодразделенияИДолжности.Период,
	|	ПодразделенияИДолжности.Подразделение,
	|	ПодразделенияИДолжности.Должность,
	|	ПодразделенияИДолжности.ДатаПеремещения
	|ПОМЕСТИТЬ втПодразделенияИДолжности
	|ИЗ
	|	&втДанныеПоПодразделениямИДолжностям КАК ПодразделенияИДолжности
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПодразделенияИДолжности.Сотрудник,
	|	МАКСИМУМ(втПодразделенияИДолжности.Период) КАК Период,
	|	&КонецМесяца
	|ПОМЕСТИТЬ втМаскимальноВозможныйПериод
	|ИЗ
	|	втПодразделенияИДолжности КАК втПодразделенияИДолжности
	|
	|СГРУППИРОВАТЬ ПО
	|	втПодразделенияИДолжности.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	втПодразделенияИДолжности.Период КАК Период,
	|	ГрафикРаботыСотрудников.Период КАК ПериодЗаписи,
	|	ГрафикРаботыСотрудников.Сотрудник,
	|	ВЫБОР
	|		КОГДА ГрафикРаботыСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ ГрафикРаботыСотрудников.ДействуетДо >= втПодразделенияИДолжности.Период
	|			ТОГДА ГрафикРаботыСотрудников.ГрафикРаботы
	|		ИНАЧЕ ГрафикРаботыСотрудников.ГрафикРаботыПоОкончании
	|	КОНЕЦ КАК ГрафикРаботы
	|ПОМЕСТИТЬ втГрафикРаботыПоПериодам
	|ИЗ
	|	РегистрСведений.ГрафикРаботыСотрудников КАК ГрафикРаботыСотрудников
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втПодразделенияИДолжности КАК втПодразделенияИДолжности
	|		ПО ГрафикРаботыСотрудников.Сотрудник = втПодразделенияИДолжности.Сотрудник
	|			И ГрафикРаботыСотрудников.Период <= втПодразделенияИДолжности.Период
	|ГДЕ
	|	ГрафикРаботыСотрудников.Сотрудник В(&Сотрудник)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втГрафикРаботыИсходный.Сотрудник,
	|	втГрафикРаботыИсходный.Период,
	|	МАКСИМУМ(втГрафикРаботыИсходный.ПериодЗаписи) КАК ПериодЗаписи
	|ПОМЕСТИТЬ втМаксимумПериодаПоПериодам
	|ИЗ
	|	втГрафикРаботыПоПериодам КАК втГрафикРаботыИсходный
	|
	|СГРУППИРОВАТЬ ПО
	|	втГрафикРаботыИсходный.Сотрудник,
	|	втГрафикРаботыИсходный.Период
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втГрафикРаботыПоПериодам.Период КАК Период,
	|	втГрафикРаботыПоПериодам.Сотрудник,
	|	МАКСИМУМ(втГрафикРаботыПоПериодам.ГрафикРаботы) КАК ГрафикРаботы
	|ПОМЕСТИТЬ втСрезГрафиковПоПериодам
	|ИЗ
	|	втГрафикРаботыПоПериодам КАК втГрафикРаботыПоПериодам
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаксимумПериодаПоПериодам КАК втМаксимумПериодаПоПериодам
	|		ПО втГрафикРаботыПоПериодам.Сотрудник = втМаксимумПериодаПоПериодам.Сотрудник
	|			И втГрафикРаботыПоПериодам.ПериодЗаписи = втМаксимумПериодаПоПериодам.ПериодЗаписи
	|
	|СГРУППИРОВАТЬ ПО
	|	втГрафикРаботыПоПериодам.Период,
	|	втГрафикРаботыПоПериодам.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ГрафикРаботыСотрудниковСрезПоследних.Период КАК ПериодЗаписи,
	|	ГрафикРаботыСотрудниковСрезПоследних.Сотрудник,
	|	ВЫБОР
	|		КОГДА ГрафикРаботыСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ ГрафикРаботыСотрудниковСрезПоследних.ДействуетДо >= &КонецМесяца
	|			ТОГДА ГрафикРаботыСотрудниковСрезПоследних.ГрафикРаботы
	|		ИНАЧЕ ГрафикРаботыСотрудниковСрезПоследних.ГрафикРаботыПоОкончании
	|	КОНЕЦ КАК ГрафикРаботы
	|ПОМЕСТИТЬ втГрафикРаботыНаКонецМесяца
	|ИЗ
	|	РегистрСведений.ГрафикРаботыСотрудников.СрезПоследних(&КонецМесяца, Сотрудник В (&Сотрудник)) КАК ГрафикРаботыСотрудниковСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втГрафикРаботыНаКонецМесяца.Сотрудник,
	|	МАКСИМУМ(втГрафикРаботыНаКонецМесяца.ПериодЗаписи) КАК ПериодЗаписи
	|ПОМЕСТИТЬ втМаксимумПериодаНаКонец
	|ИЗ
	|	втГрафикРаботыНаКонецМесяца КАК втГрафикРаботыНаКонецМесяца
	|
	|СГРУППИРОВАТЬ ПО
	|	втГрафикРаботыНаКонецМесяца.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втМаскимальноВозможныйПериод.Период,
	|	втГрафикРаботыНаКонецМесяца.Сотрудник,
	|	втГрафикРаботыНаКонецМесяца.ГрафикРаботы
	|ПОМЕСТИТЬ втСрезГрафиковНаКонецМесяца
	|ИЗ
	|	втГрафикРаботыНаКонецМесяца КАК втГрафикРаботыНаКонецМесяца
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаксимумПериодаНаКонец КАК втМаксимумПериодаНаКонец
	|		ПО втГрафикРаботыНаКонецМесяца.ПериодЗаписи = втМаксимумПериодаНаКонец.ПериодЗаписи
	|			И втГрафикРаботыНаКонецМесяца.Сотрудник = втМаксимумПериодаНаКонец.Сотрудник
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаскимальноВозможныйПериод КАК втМаскимальноВозможныйПериод
	|		ПО втГрафикРаботыНаКонецМесяца.Сотрудник = втМаскимальноВозможныйПериод.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезГрафиковПоПериодам.Период,
	|	втСрезГрафиковПоПериодам.Сотрудник,
	|	втСрезГрафиковПоПериодам.ГрафикРаботы
	|ПОМЕСТИТЬ втОбъединениеТаблиц
	|ИЗ
	|	втСрезГрафиковПоПериодам КАК втСрезГрафиковПоПериодам
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втСрезГрафиковНаКонецМесяца.Период,
	|	втСрезГрафиковНаКонецМесяца.Сотрудник,
	|	втСрезГрафиковНаКонецМесяца.ГрафикРаботы
	|ИЗ
	|	втСрезГрафиковНаКонецМесяца КАК втСрезГрафиковНаКонецМесяца
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОбъединениеТаблиц.Период,
	|	втОбъединениеТаблиц.Сотрудник,
	|	МАКСИМУМ(втОбъединениеТаблиц.ГрафикРаботы) КАК ГрафикРаботы
	|ИЗ
	|	втОбъединениеТаблиц КАК втОбъединениеТаблиц
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеТаблиц.Сотрудник,
	|	втОбъединениеТаблиц.Период"";
	Возврат ТекстЗапроса;
	
КонецФункции

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоРазрядамИКатегории()
	
	ТекстЗапроса = 
	""ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(&ПервоеЧислоМесяца, ДЕНЬ) КАК Период,
	|	РазрядыКатегорииСотрудниковСрезПоследних.Период КАК ПериодСрез,
	|	РазрядыКатегорииСотрудниковСрезПоследних.Сотрудник,
	|	ВЫБОР
	|		КОГДА РазрядыКатегорииСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ РазрядыКатегорииСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА РазрядыКатегорииСотрудниковСрезПоследних.РазрядКатегория
	|		ИНАЧЕ РазрядыКатегорииСотрудниковСрезПоследних.РазрядКатегорияПоОкончании
	|	КОНЕЦ КАК РазрядКатегория
	|ПОМЕСТИТЬ втСрезРазрядыКатегорииИсходный
	|ИЗ
	|	РегистрСведений.РазрядыКатегорииСотрудников.СрезПоследних(&ПервоеЧислоМесяца, Сотрудник В (&Сотрудник)) КАК РазрядыКатегорииСотрудниковСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезРазрядыКатегорииИсходный.Сотрудник,
	|	МАКСИМУМ(втСрезРазрядыКатегорииИсходный.ПериодСрез) КАК ПериодСрез
	|ПОМЕСТИТЬ втМаксимумРазрядыКатегории
	|ИЗ
	|	втСрезРазрядыКатегорииИсходный КАК втСрезРазрядыКатегорииИсходный
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезРазрядыКатегорииИсходный.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезРазрядыКатегорииИсходный.Период,
	|	втСрезРазрядыКатегорииИсходный.Сотрудник,
	|	втСрезРазрядыКатегорииИсходный.РазрядКатегория
	|ПОМЕСТИТЬ втПоследниеРазрядыКатегории
	|ИЗ
	|	втСрезРазрядыКатегорииИсходный КАК втСрезРазрядыКатегорииИсходный
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаксимумРазрядыКатегории КАК втМаксимумРазрядыКатегории
	|		ПО втСрезРазрядыКатегорииИсходный.Сотрудник = втМаксимумРазрядыКатегории.Сотрудник
	|			И втСрезРазрядыКатегорииИсходный.ПериодСрез = втМаксимумРазрядыКатегории.ПериодСрез
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(РазрядыКатегорииСотрудников.Период, ДЕНЬ) КАК Период,
	|	РазрядыКатегорииСотрудников.Сотрудник,
	|	ВЫБОР
	|		КОГДА РазрядыКатегорииСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ РазрядыКатегорииСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА РазрядыКатегорииСотрудников.РазрядКатегория
	|		ИНАЧЕ РазрядыКатегорииСотрудников.РазрядКатегорияПоОкончании
	|	КОНЕЦ КАК РазрядКатегория
	|ПОМЕСТИТЬ втИзмененияРазрядовКатегории
	|ИЗ
	|	РегистрСведений.РазрядыКатегорииСотрудников КАК РазрядыКатегорииСотрудников
	|ГДЕ
	|	РазрядыКатегорииСотрудников.Сотрудник В(&Сотрудник)
	|	И РазрядыКатегорииСотрудников.Период МЕЖДУ &ВтороеЧислоМесяца И &КонецМесяца
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПоследниеРазрядыКатегории.Период,
	|	втПоследниеРазрядыКатегории.Сотрудник,
	|	втПоследниеРазрядыКатегории.РазрядКатегория
	|ПОМЕСТИТЬ втОбъединениеДанныхПоРазрядам
	|ИЗ
	|	втПоследниеРазрядыКатегории КАК втПоследниеРазрядыКатегории
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втИзмененияРазрядовКатегории.Период,
	|	втИзмененияРазрядовКатегории.Сотрудник,
	|	втИзмененияРазрядовКатегории.РазрядКатегория
	|ИЗ
	|	втИзмененияРазрядовКатегории КАК втИзмененияРазрядовКатегории
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОбъединениеДанныхПоРазрядам.Период,
	|	втОбъединениеДанныхПоРазрядам.Сотрудник,
	|	МИНИМУМ(втОбъединениеДанныхПоРазрядам.РазрядКатегория) КАК РазрядКатегория
	|ИЗ
	|	втОбъединениеДанныхПоРазрядам КАК втОбъединениеДанныхПоРазрядам
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеДанныхПоРазрядам.Период,
	|	втОбъединениеДанныхПоРазрядам.Сотрудник"";
	Возврат ТекстЗапроса;
	
КонецФункции

&НаСервереБезКонтекста
Функция СформироватьТекстЗапросаПоДолжностямИПодразделениям()
	
	ТекстЗапроса = 
	""ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(&ПервоеЧислоМесяца, ДЕНЬ) КАК Период,
	|	КадроваяИсторияСотрудниковСрезПоследних.Сотрудник,
	|	ВЫБОР
	|		КОГДА КадроваяИсторияСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ КадроваяИсторияСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА КадроваяИсторияСотрудниковСрезПоследних.Подразделение
	|		ИНАЧЕ КадроваяИсторияСотрудниковСрезПоследних.ПодразделениеПоОкончании
	|	КОНЕЦ КАК Подразделение,
	|	ВЫБОР
	|		КОГДА КадроваяИсторияСотрудниковСрезПоследних.ДействуетДо = &ПустаяДата
	|				ИЛИ КадроваяИсторияСотрудниковСрезПоследних.ДействуетДо >= &ВтороеЧислоМесяца
	|			ТОГДА КадроваяИсторияСотрудниковСрезПоследних.Должность
	|		ИНАЧЕ КадроваяИсторияСотрудниковСрезПоследних.ДолжностьПоОкончании
	|	КОНЕЦ КАК Должность,
	|	НАЧАЛОПЕРИОДА(КадроваяИсторияСотрудниковСрезПоследних.Регистратор.Дата, ДЕНЬ) КАК ДатаПеремещения
	|ПОМЕСТИТЬ втСрезКадровойИстории
	|ИЗ
	|	РегистрСведений.КадроваяИсторияСотрудников.СрезПоследних(&ПервоеЧислоМесяца, Сотрудник В (&Сотрудник)) КАК КадроваяИсторияСотрудниковСрезПоследних
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезКадровойИстории.Сотрудник,
	|	МАКСИМУМ(втСрезКадровойИстории.ДатаПеремещения) КАК ПериодСрез
	|ПОМЕСТИТЬ втМаксимумКадровойИстории
	|ИЗ
	|	втСрезКадровойИстории КАК втСрезКадровойИстории
	|
	|СГРУППИРОВАТЬ ПО
	|	втСрезКадровойИстории.Сотрудник
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втСрезКадровойИстории.Период,
	|	втСрезКадровойИстории.Сотрудник,
	|	втСрезКадровойИстории.Подразделение,
	|	втСрезКадровойИстории.Должность,
	|	втСрезКадровойИстории.ДатаПеремещения
	|ПОМЕСТИТЬ втПоследнийСрезКадровойИстории
	|ИЗ
	|	втСрезКадровойИстории КАК втСрезКадровойИстории
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втМаксимумКадровойИстории КАК втМаксимумКадровойИстории
	|		ПО втСрезКадровойИстории.Сотрудник = втМаксимумКадровойИстории.Сотрудник
	|			И втСрезКадровойИстории.ДатаПеремещения = втМаксимумКадровойИстории.ПериодСрез
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	НАЧАЛОПЕРИОДА(КадроваяИсторияСотрудников.Период, ДЕНЬ) КАК Период,
	|	КадроваяИсторияСотрудников.Сотрудник,
	|	ВЫБОР
	|		КОГДА КадроваяИсторияСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ КадроваяИсторияСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА КадроваяИсторияСотрудников.Подразделение
	|		ИНАЧЕ КадроваяИсторияСотрудников.ПодразделениеПоОкончании
	|	КОНЕЦ КАК Подразделение,
	|	ВЫБОР
	|		КОГДА КадроваяИсторияСотрудников.ДействуетДо = &ПустаяДата
	|				ИЛИ КадроваяИсторияСотрудников.ДействуетДо >= &КонецМесяца
	|			ТОГДА КадроваяИсторияСотрудников.Должность
	|		ИНАЧЕ КадроваяИсторияСотрудников.ДолжностьПоОкончании
	|	КОНЕЦ КАК Должность
	|ПОМЕСТИТЬ втКадровыеИзменения
	|ИЗ
	|	РегистрСведений.КадроваяИсторияСотрудников КАК КадроваяИсторияСотрудников
	|ГДЕ
	|	КадроваяИсторияСотрудников.Период МЕЖДУ &ВтороеЧислоМесяца И &КонецМесяца
	|	И КадроваяИсторияСотрудников.Сотрудник В(&Сотрудник)
	|	И НЕ(КадроваяИсторияСотрудников.Регистратор ССЫЛКА Документ.Увольнение
	|				ИЛИ КадроваяИсторияСотрудников.Регистратор ССЫЛКА Документ.УвольнениеСписком)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПоследнийСрезКадровойИстории.Период,
	|	втПоследнийСрезКадровойИстории.Сотрудник,
	|	втПоследнийСрезКадровойИстории.Подразделение,
	|	втПоследнийСрезКадровойИстории.Должность,
	|	втПоследнийСрезКадровойИстории.ДатаПеремещения
	|ПОМЕСТИТЬ втОбъединениеКадровыхДанных
	|ИЗ
	|	втПоследнийСрезКадровойИстории КАК втПоследнийСрезКадровойИстории
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	втКадровыеИзменения.Период,
	|	втКадровыеИзменения.Сотрудник,
	|	втКадровыеИзменения.Подразделение,
	|	втКадровыеИзменения.Должность,
	|	НАЧАЛОПЕРИОДА(втКадровыеИзменения.Период, ДЕНЬ)
	|ИЗ
	|	втКадровыеИзменения КАК втКадровыеИзменения
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втОбъединениеКадровыхДанных.Период,
	|	втОбъединениеКадровыхДанных.Сотрудник,
	|	МАКСИМУМ(втОбъединениеКадровыхДанных.Подразделение) КАК Подразделение,
	|	МАКСИМУМ(втОбъединениеКадровыхДанных.Должность) КАК Должность,
	|	МАКСИМУМ(втОбъединениеКадровыхДанных.ДатаПеремещения) КАК ДатаПеремещения
	|ИЗ
	|	втОбъединениеКадровыхДанных КАК втОбъединениеКадровыхДанных
	|
	|СГРУППИРОВАТЬ ПО
	|	втОбъединениеКадровыхДанных.Период,
	|	втОбъединениеКадровыхДанных.Сотрудник"";
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

#Область Расшифровка

&НаСервере
Функция ПолучитьЗначениеРасшифровки(Расшифровка)
	
	КоллекцияРасшифровок = ПолучитьИзВременногоХранилища(ДанныеРасшифровки);
	Попытка
		КоллекцияПолей = КоллекцияРасшифровок.Элементы[Расшифровка].ПолучитьПоля();
		Действие       = КоллекцияРасшифровок.Элементы[Расшифровка].ОсновноеДействие;
	Исключение
		Возврат Неопределено; 
	КонецПопытки;
	
	Если Действие = ДействиеОбработкиРасшифровкиКомпоновкиДанных.ОткрытьЗначение Тогда
		Если КоллекцияПолей.Количество() = 2 Тогда
			ЗначениеРасшифровки = ?(ПустаяСтрока(КоллекцияПолей[0].Значение),КоллекцияПолей[1].Значение,КоллекцияПолей[0].Значение);    
			Возврат ЗначениеРасшифровки;    
		Иначе
			ЗначениеРасшифровки = КоллекцияПолей[0].Значение;
			Если ТипЗнч(ЗначениеРасшифровки) <> Тип(""Дата"") 
				ИЛИ ТипЗнч(ЗначениеРасшифровки) <> Тип(""Число"")
				ИЛИ ТипЗнч(ЗначениеРасшифровки) <> Тип(""Null"") Тогда
				Возврат ЗначениеРасшифровки;
			Иначе
				Возврат Неопределено;
			КонецЕсли;
		КонецЕсли;
	Иначе
		Возврат Неопределено;
	КонецЕсли;
	
КонецФункции

&НаКлиенте
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Попытка
		ЗначениеРасшифровки = ПолучитьЗначениеРасшифровки(Расшифровка);
		Если ЗначениеРасшифровки <> Неопределено Тогда
			ПоказатьЗначение(,ЗначениеРасшифровки);    
		КонецЕсли;              		
	Исключение
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = ОписаниеОшибки();
		Сообщение.Сообщить();
	КонецПопытки;

КонецПроцедуры

#КонецОбласти

#Область Сервисные_процедуры_для_формы

&НаКлиенте
Процедура ВычислитьСумму(Команда)
	СтандартныеПодсистемыКлиент.ПоказатьРасчетЯчеек(ЭтотОбъект, Результат);
КонецПроцедуры

// Элемент месяц

&НаКлиенте
Процедура МесяцНачисленияСтрокойПриИзменении(Элемент)
	ЗарплатаКадрыКлиент.ВводМесяцаПриИзменении(ЭтаФорма, ""Отчет.ПериодРегистрации"", ""МесяцНачисленияСтрокой"", Модифицированность);
КонецПроцедуры

&НаКлиенте
Процедура МесяцНачисленияСтрокойНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка) 	
	ЗарплатаКадрыКлиент.ВводМесяцаНачалоВыбора(ЭтаФорма, ЭтаФорма, ""Отчет.ПериодРегистрации"", ""МесяцНачисленияСтрокой"");
КонецПроцедуры

&НаКлиенте
Процедура МесяцНачисленияСтрокойРегулирование(Элемент, Направление, СтандартнаяОбработка)	
	ЗарплатаКадрыКлиент.ВводМесяцаРегулирование(ЭтаФорма, ""Отчет.ПериодРегистрации"", ""МесяцНачисленияСтрокой"", Направление, Модифицированность);		
КонецПроцедуры

&НаКлиенте
Процедура МесяцНачисленияСтрокойАвтоПодбор(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, Ожидание, СтандартнаяОбработка)
	ЗарплатаКадрыКлиент.ВводМесяцаАвтоПодборТекста(Текст, ДанныеВыбора, СтандартнаяОбработка);
КонецПроцедуры

&НаКлиенте
Процедура МесяцНачисленияСтрокойОкончаниеВводаТекста(Элемент, Текст, ДанныеВыбора, ПараметрыПолученияДанных, СтандартнаяОбработка)
	ЗарплатаКадрыКлиент.ВводМесяцаОкончаниеВводаТекста(Текст, ДанныеВыбора, СтандартнаяОбработка);
КонецПроцедуры

#КонецОбласти

